---
title: Build a Web App
description: Use this template to build a Web App using **Django & Postgres**, a mature full stack setup.
---

<Note>

Install [docker desktop](https://docs.docker.com/desktop/install/mac-install/) to run this app locally.

</Note>

## Setup

Open the `Terminal` and create an `ai` directory with a python virtual environment.

<CodeGroup>

```bash Mac
mkdir ai && cd ai

python3 -m venv aienv
source aienv/bin/activate
```

```bash Windows
mkdir ai; cd ai

python3 -m venv aienv
aienv/scripts/activate
```

</CodeGroup>

Install `phidata`

<CodeGroup>

```bash Mac
pip install -U phidata
```

```bash Windows
pip install -U phidata
```

</CodeGroup>

<Note>

If you encounter errors, update pip using `python -m pip install --upgrade pip`

</Note>

## Create your codebase

Create your codebase using the `django-app` template.

<CodeGroup>

```bash Mac
phi ws create -t django-app -n django-app
```

```bash Windows
phi ws create -t django-app -n django-app
```

</CodeGroup>

This will create a folder named `django-app` with the following structure:

```bash django-app
django-app                # root directory for your django-app
├── app                   # directory for the Jjango project
├── nginx                 # directory for nginx used in production for static files
├── manage.py             # django-admin file
├── dev.Dockerfile        # Dockerfile for the dev application
├── prd.Dockerfile        # Dockerfile for the production application
├── pyproject.toml        # python project definition
├── requirements.txt      # python dependencies generated by pyproject.toml
├── scripts               # directory for helper scripts
├── tests                 # directory for unit tests
└── workspace             # phidata workspace directory
    ├── dev_resources.py  # dev resources running locally
    ├── prd_resources.py  # production resources running on AWS
    ├── secrets           # directory for storing secrets
    └── settings.py       # phidata workspace settings
```

### Optional: Set OpenAI Api Key

To use your own `OPENAI_API_KEY`, set the `OPENAI_API_KEY` environment variable. You can get one [from OpenAI here](https://platform.openai.com/account/api-keys). Otherwise `phi` provides ready to use access to OpenAI models.

<CodeGroup>

```bash Mac
export OPENAI_API_KEY=sk-***
```

```bash Windows
setx OPENAI_API_KEY sk-***
```

</CodeGroup>

## Local Django App

Your codebase comes with a <LinkOpenNewTab href="https://www.djangoproject.com/" text="Django" /> application connected to a [Postgres](https://www.postgresql.org/) database. Run it using:

<CodeGroup>

```bash terminal
phi ws up
```

```bash With Options
phi ws up --env dev --infra docker
```

```bash shorthand
phi ws up dev:docker
```

</CodeGroup>

**Press Enter** to confirm and give a few minutes for the image to download (only the first time). Verify container status and view logs on the docker dashboard.

### View the Django App

Open [localhost:8000](http://localhost:8000) to view the Django App running locally.

<ImageContainer
  src="/images/django-app-django-local.png"
  alt="django-app-django-local"
/>

## Local Django Admin

Open <LinkOpenNewTab href="http://localhost:8000/admin" text="localhost:8000/admin" /> to view the Django admin site. Create an admin user by running:

```bash
docker exec -it django-dev-app python manage.py createsuperuser
```

Log in to the admin panel:

<ImageContainer
  src="/images/django-app-django-admin-local.png"
  alt="django-app-django-admin-local"
/>

## Build your Web App

The <LinkOpenNewTab href="https://docs.djangoproject.com/en/4.2/intro/tutorial01/" text="Django Tutorials" /> are a great place to learn about Django, play around and update your Web App to your use case. Here's how to create a simple chat application:

**1. Create a new django app**

```bash
docker exec -it django-dev-app python manage.py startapp chat
```

<Note>

Read more about <LinkOpenNewTab href="https://docs.djangoproject.com/en/4.2/intro/tutorial01/#creating-the-polls-app" text="django apps here" />

</Note>

**2. Register the chat app**

Update the 'app/settings.py' file and register the `chat`

```python app/settings.py
...
INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    # register the chat app
    'chat',
]
...
```

**3. Create views for the chat app**

Update the `chat/views.py` file to

```python chat/views.py
from django.shortcuts import render, redirect

from phi.conversation import Conversation

def index(request):
    try:
        # Create a conversation
        conversation = Conversation()
        if 'messages' not in request.session:
            request.session['messages'] = []
        if request.method == 'POST':
            prompt = request.POST.get('prompt')
            # Add the prompt to the messages
            request.session['messages'].append({"role": "user", "content": prompt})
            # Set the session as modified
            request.session.modified = True
            # Create a response
            response = conversation.chat(prompt, stream=False)
            # Append the response to the messages
            request.session['messages'].append({"role": "assistant", "content": response})
            # Set the session as modified
            request.session.modified = True
            # Redirect to the home page
            context = {
                'messages': request.session['messages'],
                'prompt': '',
            }
            return render(request, 'chat/index.html', context)
        else:
            context = {
                'messages': request.session['messages'],
                'prompt': '',
            }
            return render(request, 'chat/index.html', context)
    except Exception as e:
        print(e)
        return redirect('index')


def new_chat(request):
    # -*- Clears the session messages and redirects to the home page -*-
    request.session.pop('conversation', None)
    request.session.pop('messages', None)
    return redirect('index')
```

**4. Configure URLs**

Create a file named `urls.py` in the chat folder:

```python chat/urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('', views.index, name='index'),
    path('new_chat/', views.new_chat, name='new_chat'),
]
```

Update the `app/urls.py` file to:

```python app/urls.py
from django.contrib import admin
from django.urls import include, path

urlpatterns = [
    path("admin/", admin.site.urls),
    path('chat/', include('chat.urls')),
]
```

**5. Create templates**

Create the HTML templates for the chat interface in the `chat/templates/chat` folder.

```python chat/templates/chat/base.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat | {% block title %}  {% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    {% block content %}
    {% endblock %}
</body>
</html>
```

```python chat/templates/chat/index.html
{% extends 'chat/base.html' %}
{% block title %} Home {% endblock %}
{% block content %}
<div class="row justify-content-center my-4">
    <div class="col-md-7 mt-4">
        <div class="card">
            <h2 class="card-header text-center">LLM Chat</h2>
            <div class="card-body">
              <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-primary mb-3" onclick="location.href='{% url 'new_chat' %}'">New Chat</button>
              </div>
              <div class="chat-history mb-3">
                {% for message in messages %}
                  <div class="card mb-2 {% if message.role == 'assistant' %}bg-success text-white{% endif %}">
                    <div class="card-body p-2">
                      <strong>{{ message.role|title }}:</strong> {{ message.content|linebreaksbr }}
                    </div>
                  </div>
                {% endfor %}
              </div>
              <form action="." method="POST">
                <!-- this secures the form from malicious attacks during submission -->
                {% csrf_token %}
                <label for="prompt" class="form-label">Send a message</label>
                <input class="form-control mb-2" required type="text" autofocus="autofocus" name="prompt" value="{{ prompt }}" id="">
                <button class="btn btn-success fw-bold" type="submit">
                  Send
                </button>
              </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

**6. Open Django App**

Open <LinkOpenNewTab href="http://localhost:8000/chat/" text="localhost:8000/chat/" /> to view the LLM chat app.

<ImageContainer
  src="/images/django-app-chat-app.png"
  alt="django-app-chat-app"
/>

<Note>

If needed, restart the django server using `phi ws restart dev:docker:app -y`

</Note>

## Delete local resources

Stop the workspace using:

<CodeGroup>

```bash terminal
phi ws down
```

```bash With Options
phi ws down --env dev --infra docker
```

```bash shorthand
phi ws down dev:docker
```

</CodeGroup>

---

## Run on AWS

Now let's run the **Django App** in production on AWS.

### AWS Authentication

To run on AWS, you need **one** of the following:

1. The `~/.aws/credentials` file with your AWS credentials
2. `AWS_ACCESS_KEY_ID` + `AWS_SECRET_ACCESS_KEY` environment variables

<Note>

To create the credentials file, install the [aws cli](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html) and run `aws configure`

</Note>

### Add AWS Region and Subnets

Add 2 [Subnets](https://us-east-1.console.aws.amazon.com/vpc/home?#subnets:) to the `workspace/settings.py` file, these are required for the ECS services.

```python workspace/settings.py
ws_settings = WorkspaceSettings(
    ...
    # -*- AWS settings
    # Add your Subnet IDs here
    subnet_ids=["subnet-xyz", "subnet-xyz"],
    ...
)
```

<Note>

Please check that the subnets belong to the selected `aws_region`

</Note>

## Update Secrets

Update the RDS database password in the `workspace/secrets/prd_db_secrets.yml` file:

```python workspace/secrets/prd_db_secrets.yml
# Secrets used by RDS Database
MASTER_USERNAME: app
MASTER_USER_PASSWORD: "app9999!!"
```

## Create AWS resources

Create AWS resources for the Django App using:

<CodeGroup>

```bash terminal
phi ws up --env prd --infra aws
```

```bash shorthand
phi ws up prd:aws
```

</CodeGroup>

This will create:

1. [ECS Cluster](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/clusters.html) for running the application.
2. [ECS Task Definitions](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definitions.html) and [Services](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs_services.html) that run the application on the ECS cluster.
3. [LoadBalancer](https://aws.amazon.com/elasticloadbalancing/) to route traffic to the application.
4. [Security Groups](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-groups.html) that control incoming and outgoing traffic.
5. [Secrets](https://aws.amazon.com/secrets-manager/) for managing application and database secrets.
6. [RDS Database](https://aws.amazon.com/rds/) for Knowledge Base and Storage.

**Press Enter** to confirm and grab a cup of coffee while the resources spin up.

- The RDS database takes about 10 minutes to activate.
- These resources are defined in the `workspace/prd_resources.py` file.
- Use the [ECS console](https://us-east-1.console.aws.amazon.com/ecs/v2/clusters) to view services and logs.
- Use the [RDS console](https://us-east-1.console.aws.amazon.com/rds/home?#databases:) to view the database instance.

## Production Django app

**Open the LoadBalancer DNS** to view your Django App running on AWS.

<ImageContainer
  src="/images/django-app-django-prd.png"
  alt="django-app-django-prd"
/>

## Production Django Admin

Open the **LoadBalancer DNS** + `/admin` page to view the Django admin site.

Create an admin user by SSH-ing into the production container:

```bash
ECS_CLUSTER=django-prd
TASK_ARN=$(aws ecs list-tasks --cluster django-prd --query "taskArns[0]" --output text)
CONTAINER_NAME=django-prd

aws ecs execute-command --cluster $ECS_CLUSTER \
    --task $TASK_ARN \
    --container $CONTAINER_NAME \
    --interactive \
    --command "python manage.py createsuperuser"
```

Log in to the admin panel:

<ImageContainer
  src="/images/django-app-django-admin-prd.png"
  alt="django-app-django-admin-prd"
/>

## Update Production

To update the production application, follow [this guide](/how-to/production-app) TO

1. Create a new image
2. Update the ECS Task Definition and Services.

## Delete AWS resources

Play around and then delete AWS resources using:

<CodeGroup>

```bash terminal
phi ws down --env prd --infra aws
```

```bash shorthand
phi ws down prd:aws
```

</CodeGroup>

or delete individual resource groups using:

<CodeGroup>

```bash Api
phi ws down --env prd --infra aws --group app
```

```bash Database
phi ws down --env prd --infra aws --group db
```

</CodeGroup>

## Next

Congratulations on running a prodution-ready Web App using Django. Next Steps:

- Modify this App to your use case.
- Create a [git repository for this workspace](/how-to/git-repo).
- Read how to [update the dev application](/how-to/dev-app).
- Read how to [update the production application](/how-to/production-app).
- Read how to [format and validate your code](/how-to/format-and-validate).
- Read how to [add python libraries](/how-to/python-libraries).
- Read how to [add database tables](/how-to/database-tables)
- Read how to [add a custom domain and HTTPS](/how-to/domain-https).
- Read how to [implement CI/CD](/how-to/ci-cd)
- Learn about other [day-2 operations](/how-to/how-to-operations).
- Chat with us on [discord](https://discord.gg/4MtYHHrgA8).

---
